apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: herodote
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: "0.0.84"
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: herodote
    image:
      name: vibioh/herodote
      tag: "202207160753" # {"$imagepolicy": "default:flux-herodote-web:tag"}
    config:
      HERODOTE_DB_HOST: herodote-db
      HERODOTE_DB_NAME: herodote
      HERODOTE_DB_PORT: "80"
      HERODOTE_DB_USER: herodote
      HERODOTE_LOGGER_JSON: "true"
      HERODOTE_TRACER_URL: http://jaeger.monitoring:14268/api/traces
      OTEL_SERVICE_NAME: herodote
    secrets:
      HERODOTE_DB_PASS: AgCBhQXAiqDlN4ilxOJycc64hN5XC8mTB0/gLRGEEQrL9bQPmvoxX6bABd9i2yWcxHhnn6z6rGLgjf1z/m0tgPlIH3M1x3AuGjlG96TPEM3COAmeHvas8vKmpEAupsXJGCvMtVdzcEQfZHQcP5NySdjgH5h+ztZFP6A1UzJvmzFhM5AHVJkQ57T22fAbvLJLvxm4riTEOfmXvTBQ2kd94pM6TfE4ucOZGr9aPthKAqrvlq1MefHx9zxIhdNrv0OmQ29IMvyHUkmLSFMIiGYpKh0YgXHyp052NrktL+Tmk41qlPh6tIE/eRz5wULaE7zHoZIn398pJT8TyYTEYJLQwO5E0Oe6mA8QjXkvVb+NQ9vegG5jgjlwj7NuXAwEXoYRvqg9eJwabNnpvZPpxh1nz9SM5aTV5uN3ltPSK80LS+AUZt32r0n5sGR6VMXfkjxt+6pvKVHHgxWyim3+PKJNy+DPKNHYfsLi+2Kfj5kISZ6drXIHg+r7Mp4MvQX4g+f5BQ15xektLeViUi0i3WZr94SGlt1dJYIgt7ssJmd+BKTzIinzOleNvD7K5hbhcYwEn8z/oy8rJ9TkPHIFUV0OwhjT20kbhPkM+KlymSH70kIqY5WcD7lW15zclbYw8ggQsdVIU5qw3cD+oHojbQeiZbdWZy3YIPEEFn3Cu4jkYo2mzO1+pFH5Nh66n2NPY4kqKz8SGJogdFcHqGBDsogMJCOJ+r5yTsN2rIfeL+GFg8LD8wCB3doC0SVBhyrBVff+fg+F6FWWEVlRzXArqCw=
      HERODOTE_HTTP_SECRET: AgBYpyyb0D9PSGjYNXiT+fqeffYyM/2zsk8K+Q5jLXRJtiex1SxmvN6TQRqe04ALj8457BdVKrz94iE+LE0keVB5k6D1UMINaxiE3zjT5H3KVXK3g08yOdBxTdSqpzmliiLRfiKHot2FngPCAfJLzY+jJHETNdnObOWE80/G0BLUWp3ZSdiqfwvIW/YqawQ4GJeZiBgiYxHN2a0sEruE7nb/xHVrnbxsqMzsG4CEkLqvL3Hg47fUhyvSHlKAg8vBogpMXws0oQcx2JTm+bGFEp90s8jJRRg7E2k4RKy75Sr/Mya6SdmRU+BtqNSjBUKGYa0tfGYhzNfRsdFr+OfHRHny1UjsnJeQri3rl0j4l1q0A06OvD6afSJC6YHHNreUgZwAMMTuZAUglQGteuVIq2lrvKXgiatVDMkXV2jSUqd6fDrmRqB/Cgnrz1oFKWOtIV7YHrBgyvQkv2S6KtT/aVse54EqFvjy2X53PpnBoRknff9x1HRM0GOSYRXlyOK1KvDkSRl/VcipMAoP6LA+mG5B+BlNFOUOCUIe3w8hls6os7fXr7ILwtPV52bB8zEuQNhG768i8ShrFf4WRXzYBopsDgNWcKvO2wxoK/jMZERth3Wey6/0xF24LDgY/K6au+TwisQ4aAknMgZkEU+wWoLNMAYv7aF8KQg48e4gLHQd3bYllXyR1BA45NdtrMsbVcF8pjNi/vCRzgq7LDbIl9wDE0ftYpcl4LMcGyNA7vR/oy+cAUUpX/AlF8DxnIal5whQvMW9QsNgfaeQJJA=
    ingress:
      enabled: true
      compress: true
      hosts:
        - herodote.vibioh.fr
    affinity:
      podAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                  - key: app.kubernetes.io/instance
                    operator: In
                    values:
                      - herodote-db
              topologyKey: "kubernetes.io/hostname"
    pprof:
      enabled: true
